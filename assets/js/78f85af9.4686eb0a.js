"use strict";(self.webpackChunkhammeranims=self.webpackChunkhammeranims||[]).push([[9279],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>k});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),c=p(n),m=r,k=c["".concat(s,".").concat(m)]||c[m]||u[m]||i;return n?a.createElement(k,l(l({ref:t},d),{},{components:n})):a.createElement(k,l({ref:t},d))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[c]="string"==typeof e?e:r,l[1]=o;for(var p=2;p<i;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},2851:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const i={sidebar_position:0},l="Networking",o={unversionedId:"hammerlib/hladvanced/networking",id:"hammerlib/hladvanced/networking",title:"Networking",description:"The communication between client and server\u2026",source:"@site/docs/hammerlib/hladvanced/networking.md",sourceDirName:"hammerlib/hladvanced",slug:"/hammerlib/hladvanced/networking",permalink:"/docs/hammerlib/hladvanced/networking",draft:!1,tags:[],version:"current",sidebarPosition:0,frontMatter:{sidebar_position:0},sidebar:"tutorialSidebar",previous:{title:"HammerLib Advanced",permalink:"/docs/category/hammerlib-advanced"},next:{title:"Extras",permalink:"/docs/category/extras"}},s={},p=[{value:"How-to",id:"how-to",level:2},{value:"Each IPacket must have:",id:"each-ipacket-must-have",level:2},{value:"Must override:",id:"must-override",level:3},{value:"And either one of these:",id:"and-either-one-of-these",level:3},{value:"NBT alternative",id:"nbt-alternative",level:2},{value:"Example time!",id:"example-time",level:2},{value:"Sending the packet",id:"sending-the-packet",level:2},{value:"Client to Server:",id:"client-to-server",level:3},{value:"Server to Client:",id:"server-to-client",level:3},{value:"Large packets?",id:"large-packets",level:2}],d={toc:p},c="wrapper";function u(e){let{components:t,...n}=e;return(0,r.kt)(c,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"networking"},"Networking"),(0,r.kt)("p",null,"The communication between client and server\u2026"),(0,r.kt)("p",null,"It's very common to send packets of data between client and server inside any given mod to sync stuff around.\nHammerLib provides a clean and easy way to manage networking without having to perform any extra registrations."),(0,r.kt)("h2",{id:"how-to"},"How-to"),(0,r.kt)("p",null,"Every packet has its own class, and will handle the logic in there as well.\nThe networking code in Minecraft runs in a separate thread, and so does any of its immediate logic.\nGenerally speaking, if your packet modifies game in any way (say, places a block on server, opens a GUI on client etc), it should run on game thread, instead of network thread."),(0,r.kt)("p",null,"To create a packet, create a new class, and let it implement ",(0,r.kt)("inlineCode",{parentName:"p"},"IPacket")," from ",(0,r.kt)("inlineCode",{parentName:"p"},"org.zeith.hammerlib.net"),".\nWe will be making a client -> server packet that will spawn any entity where sender player is at, if they are in creative mode."),(0,r.kt)("p",null,"Our example should definitely run on game thread since it inserts an entity into a world, so we will also annotate the class with ",(0,r.kt)("inlineCode",{parentName:"p"},"@MainThreaded")," from ",(0,r.kt)("inlineCode",{parentName:"p"},"org.zeith.hammerlib.net"),"."),(0,r.kt)("h2",{id:"each-ipacket-must-have"},"Each IPacket must have:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"No-args constructor (used when recreating packet on destination side)"),(0,r.kt)("li",{parentName:"ul"},"Optional all-args constructor (to fill out all data inside the packet) (You can still use any other method of settings packet's fields though)")),(0,r.kt)("h3",{id:"must-override"},"Must override:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"write(FriendlyByteBuf) (used to write all data to network) (WRITE ORDER MUST MATCH READ ORDER)"),(0,r.kt)("li",{parentName:"ul"},"read(FriendlyByteBuf) (used to read all data from network) (READ ORDER MUST MATCH WRITE ORDER)")),(0,r.kt)("h3",{id:"and-either-one-of-these"},"And either one of these:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"clientExecute(PacketContext)"),(0,r.kt)("li",{parentName:"ul"},"serverExecute(PacketContext)")),(0,r.kt)("h2",{id:"nbt-alternative"},"NBT alternative"),(0,r.kt)("p",null,"There is NBT alternative to ",(0,r.kt)("inlineCode",{parentName:"p"},"IPacket"),", which is ",(0,r.kt)("inlineCode",{parentName:"p"},"INBTPacket"),", it replaces ",(0,r.kt)("inlineCode",{parentName:"p"},"FriendlyByteBuf")," inside ",(0,r.kt)("inlineCode",{parentName:"p"},"read")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"write")," methods with ",(0,r.kt)("inlineCode",{parentName:"p"},"CompoundTag"),", (which makes order of read/writing irrelevant):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"write(CompoundTag)"),(0,r.kt)("li",{parentName:"ul"},"read(CompoundTag)")),(0,r.kt)("h2",{id:"example-time"},"Example time!"),(0,r.kt)("p",null,"In our example we wanted to spawn an entity. This would require us to pass ",(0,r.kt)("inlineCode",{parentName:"p"},"EntityType<?>")," into the packet."),(0,r.kt)("p",null,"I will skip most of the explanation, and show the complete ",(0,r.kt)("inlineCode",{parentName:"p"},"PacketSpawnEntity"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"package com.yourname.yourmod.net;\n\nimport net.minecraft.network.FriendlyByteBuf;\nimport net.minecraft.world.entity.EntityType;\nimport net.minecraftforge.registries.ForgeRegistries;\nimport org.zeith.hammerlib.net.*;\n\n@MainThreaded\npublic class PacketSpawnEntity\n        implements IPacket\n{\n    protected EntityType<?> type;\n    \n    public PacketSpawnEntity(EntityType<?> type)\n    {\n        this.type = type;\n    }\n    \n    public PacketSpawnEntity()\n    {\n    }\n    \n    @Override\n    public void write(FriendlyByteBuf buf)\n    {\n        buf.writeRegistryId(ForgeRegistries.ENTITY_TYPES, this.type); // Write the entity type into buffer.\n    }\n    \n    @Override\n    public void read(FriendlyByteBuf buf)\n    {\n        this.type = buf.readRegistryId(); // Read the entity type from buffer.\n    }\n    \n    @Override\n    public void serverExecute(PacketContext ctx)\n    {\n        if(!ctx.hasSender()) return; // It was probably sent from server to itself, or the sender has since left.\n        if(type == null) return; // If the entity type is unknown to server, do an early return.\n        \n        var sender = ctx.getSender();\n        if(!sender.isCreative()) return; // We don't want to let survival players to be able to abuse our packet.\n        \n        var level = sender.getLevel(); // sender.level() in 1.20+\n        \n        var entity = type.create(level);\n        if(entity == null) return; // If entity was not allocated for any reason, skip spawning!\n        \n        entity.setPos(sender.position()); // position the entity at sender's feet\n        \n        level.addFreshEntity(entity); // finally, spawn the entity!\n    }\n}\n")),(0,r.kt)("h2",{id:"sending-the-packet"},"Sending the packet"),(0,r.kt)("p",null,"All sending is performed through ",(0,r.kt)("inlineCode",{parentName:"p"},"Network")," from ",(0,r.kt)("inlineCode",{parentName:"p"},"org.zeith.hammerlib.net"),"."),(0,r.kt)("h3",{id:"client-to-server"},"Client to Server:"),(0,r.kt)("p",null,"To send any packet from client to server, call ",(0,r.kt)("inlineCode",{parentName:"p"},"Network.sendToServer(IPacket)")),(0,r.kt)("p",null,"This is one method that should ever be used."),(0,r.kt)("h3",{id:"server-to-client"},"Server to Client:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"To all players on server: ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Network.sendToAll(IPacket)")))),(0,r.kt)("li",{parentName:"ul"},"To a specific player: (",(0,r.kt)("inlineCode",{parentName:"li"},"ServerPlayer")," preferred. Passing a ",(0,r.kt)("inlineCode",{parentName:"li"},"Player")," causes an extra check)",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Network.sendTo(Player, IPacket)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Network.sendTo(IPacket, Player)")))),(0,r.kt)("li",{parentName:"ul"},"To players around: (Permutations between two args are allowed here too!)",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Network.sendToTracking(LevelChunk, IPacket)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Network.sendToTracking(Entity, IPacket)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Network.sendToTracking(BlockEntity, IPacket)")))),(0,r.kt)("li",{parentName:"ul"},"To players around including self: (This is usually send to all players who are actively tracking the player (which is passed as Entity arg), and additionally sent to the player itself)",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Network.sendToTrackingAndSelf(Entity, IPacket)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Network.sendToTrackingAndSelf(IPacket, Entity)")))),(0,r.kt)("li",{parentName:"ul"},"To players in the same dimension:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Network.SendToDimension(Level, IPacket)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Network.SendToDimension(ResourceKey<Level>, IPacket)"))))),(0,r.kt)("h2",{id:"large-packets"},"Large packets?"),(0,r.kt)("p",null,"If your packet exceeds ",(0,r.kt)("strong",{parentName:"p"},"~32KB")," (leave about 256 bytes as a general rule of thumb for packet identification), then you might run into troubles when sending packet from client to server.\nFor the server, the packet size is much more generous, ",(0,r.kt)("strong",{parentName:"p"},"~256MB"),"."),(0,r.kt)("p",null,"In such cases, splitting a packet would be necessary. To perform splitting, use ",(0,r.kt)("inlineCode",{parentName:"p"},"NetTransport.wrap(IPacket)")," from ",(0,r.kt)("inlineCode",{parentName:"p"},"org.zeith.hammerlib.net.lft"),".\nYou will obtain a ",(0,r.kt)("inlineCode",{parentName:"p"},"TransportSession")," which has ",(0,r.kt)("inlineCode",{parentName:"p"},".send\u2026(...)")," methods to send all slices to receiver."))}u.isMDXComponent=!0}}]);